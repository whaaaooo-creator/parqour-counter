<!doctype html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea5e9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Parqour">

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Parqour — Counter</title>
<link rel="stylesheet" href="style.css?v=2">
<script src="i18n.js"></script>
<script src="numeric.js" defer></script>
<link rel="apple-touch-icon" href="icon-180.png" />
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
</head>
<body>
<div class="container">
  <div class="header">
    <a class="home" href="index.html" aria-label="Home">
      <svg viewBox="0 0 24 24"><path d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3z"/></svg>
    </a>
    <img src="parqour.png" alt="Parqour">
  </div>

  <div class="card">
    <div class="label" id="lblFree">Free</div>
    <div class="row" style="display:flex;justify-content:space-between;align-items:center">
      <div id="countFree" class="count">0</div>
    </div>
    <div class="grid2" style="margin-top:12px">
      <button class="full" id="incFree">+1</button>
      <button class="full" id="decFree">−1</button>
    </div>
  </div>

  <div class="card" style="margin-top:10px">
    <div class="label" id="lblPaid">Paid</div>
    <div class="row" style="display:flex;justify-content:space-between;align-items:center">
      <div id="countPaid" class="count">0</div>
    </div>
    <div class="grid2" style="margin-top:12px">
      <button class="full" id="incPaid">+1</button>
      <button class="full" id="decPaid">−1</button>
    </div>
  </div>

  <button class="full" id="saveReset" style="margin-top:12px;background:#2a1f23;border-color:#4a2a32">Save & Reset</button>

  <div class="card" style="margin-top:10px">
    <div class="row" style="display:flex;justify-content:space-between;align-items:center">
      <div class="label" id="lblJournal">Saved Journal</div>
      <button class="small" id="clearJournal">Clear Journal</button>
    </div>
    <div style="margin-top:12px;overflow-x:auto">
      <table id="journalTable">
        <thead><tr><th>#</th><th id="thTime">Timestamp</th><th id="thFree">Free</th><th id="thPaid">Paid</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="footer" id="note">All data is saved locally in your browser (persists after closing).</div>
</div>

<script>
const t={
  en:{free:'Free',paid:'Paid',save:'Save & Reset',journal:'Saved Journal',clear:'Clear Journal',time:'Timestamp',note:'All data is saved locally in your browser (persists after closing).'},
  ru:{free:'Бесплатные',paid:'Платные',save:'Сохранить и сбросить',journal:'Сохранённый журнал',clear:'Очистить журнал',time:'Время',note:'Все данные сохраняются локально в вашем браузере (сохраняются после закрытия).'}
};
const L=(k)=>t[window.__lang||'en'][k];
function applyLang(){
  document.getElementById('lblFree').textContent=L('free');
  document.getElementById('lblPaid').textContent=L('paid');
  document.getElementById('saveReset').textContent=L('save');
  document.getElementById('lblJournal').textContent=L('journal');
  document.getElementById('clearJournal').textContent=L('clear');
  document.getElementById('thTime').textContent=L('time');
  document.getElementById('thFree').textContent=L('free');
  document.getElementById('thPaid').textContent=L('paid');
  document.getElementById('note').textContent=L('note');
}
applyLang();

const $=(id)=>document.getElementById(id);
const get=(k,def=0)=>{const r=localStorage.getItem(k); if(r==null) return def; try{return JSON.parse(r)}catch{return r}};
const set=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
function renderCounts(){ $('countFree').textContent=Number(get('countFree',0)); $('countPaid').textContent=Number(get('countPaid',0)); }
function inc(key,delta){ const next=Number(get(key,0))+delta; set(key,Math.max(0,next)); renderCounts(); }
function saveToJournal(freeVal,paidVal){ const j=get('journal',[]); const ts=new Date().toISOString(); j.push({ts,free:freeVal,paid:paidVal}); set('journal',j); renderJournal(); }
function renderJournal(){ const j=get('journal',[]); const tb=document.querySelector('#journalTable tbody'); tb.innerHTML=''; const rows=[...j].map((e,i)=>({...e,idx:i+1})).reverse(); rows.forEach((e,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${rows.length-i}</td><td>${new Date(e.ts).toLocaleString()}</td><td>${e.free}</td><td>${e.paid}</td>`; tb.appendChild(tr); }); }
$('incFree').onclick=()=>inc('countFree',+1); $('decFree').onclick=()=>inc('countFree',-1); $('incPaid').onclick=()=>inc('countPaid',+1); $('decPaid').onclick=()=>inc('countPaid',-1);
$('saveReset').onclick=()=>{ const f=Number(get('countFree',0)); const p=Number(get('countPaid',0)); saveToJournal(f,p); set('countFree',0); set('countPaid',0); renderCounts(); };
$('clearJournal').onclick=()=>{ if(confirm(window.__lang==='ru'?'Очистить журнал?':'Clear entire journal?')){ set('journal',[]); renderJournal(); } };
if(get('countFree')==null) set('countFree',0); if(get('countPaid')==null) set('countPaid',0); if(get('journal')==null) set('journal',[]);
renderCounts(); renderJournal();
</script>
<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('sw.js').catch(()=>{});
  });
}
</script>
</body>
</html>
